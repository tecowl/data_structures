# データ構造とリファクタリング

## 型の種類

- 値
  - 真偽値、数値、文字列、日付時刻など
  - 列挙型
- ポインタ
- コレクション Collection
    - 配列 Array
    - リスト List
    - 集合 Set
    - 連想配列 Map
- 構造体
- クラス

## 言語でのサポート状況

どの言語でも機能を作ることはできるが、ここでは言語の機能あるいは標準的なライブラリでサポートされているものを挙げる。

型 | Delphi | Go | ES5 | Ruby
--|-------|-------|-------|-------
列挙型 | (....) | *1 | 無 | 無
ポインタ | 有 | 有 | 無 | 無
配列 | array of type | []type | array | Array
リスト | TObjectList, etc | あまり使わない | array | Array
集合 | set of 順序型 | 無 | Set | (Array#uniq?)
連想配列 | TStringsのValues | map[型1]型2 | Object | Hash
構造体 | record | struct | Object | Struct
クラス | TObjectを継承 | *2 | Object | Object

## 関数とメソッド

何らかのクラスやオブジェクトなどのデータ構造に依存せずに存在するのが関数であり、依存するのがメソッドである。
関数のスコープは言語によって異なるが、グローバルなスコープの関数を多用するのはよろしくない。
できるだけ影響範囲を適切に絞って定義するべきである。

関数が特定のデータ構造に関係するのであれば、それはそのデータ構造についてのメソッドに変更するべきである。


## リファクタリングとは

誤解を恐れずに言えば、リファクタリングとは、データ構造を見直し、そのデータ構造に適した関数やメソッドを配置することである。
よって、どのようなデータ構造を持つべきであるのかを知らなければ、良いリファクタリングはできない。

## 良い構造とは

- 良い名前
    - 名前重要！
    - チーム内で合意が取れればOKだが・・・
    - 複数形
- 良い形
    - 適切な型
    - 適切なメソッド
- テストのしやすさ

## テストのしやすさ

- オブジェクトや構造体は状態を持つ
    - 状態を持っているとテストが大変
    - 副作用の少ない形へ
    - mutable から immutable へ

## JSONの例

https://www.sitepoint.com/10-example-json-files/

http://docwiki.embarcadero.com/RADStudio/Rio/ja/JSON_オブジェクト_フレームワーク
